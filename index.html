<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø³ÛŒØ³ØªÙ… Ú©Ù„Ø§Ø³ Ø¢Ù†Ù„Ø§ÛŒÙ† ØªØ¹Ø§Ù…Ù„ÛŒ</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- ØµÙØ­Ù‡ ÙˆØ±ÙˆØ¯ -->
    <div id="loginPage" class="page">
        <div class="login-container">
            <div class="login-form">
                <h2>ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ú©Ù„Ø§Ø³ Ø¢Ù†Ù„Ø§ÛŒÙ†</h2>
                <div class="form-group">
                    <label for="className">Ù†Ø§Ù… Ú©Ù„Ø§Ø³:</label>
                    <select id="className">
                        <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</option>
                        <option value="math7">Ø±ÛŒØ§Ø¶ÛŒ Ù¾Ø§ÛŒÙ‡ Ù‡ÙØªÙ… - Ø§Ø³ØªØ§Ø¯ Ø§Ø­Ù…Ø¯ÛŒ</option>
                        <option value="science7">Ø¹Ù„ÙˆÙ… Ù¾Ø§ÛŒÙ‡ Ù‡ÙØªÙ… - Ø§Ø³ØªØ§Ø¯ Ù…Ø­Ù…Ø¯ÛŒ</option>
                        <option value="persian7">Ø§Ø¯Ø¨ÛŒØ§Øª ÙØ§Ø±Ø³ÛŒ - Ø§Ø³ØªØ§Ø¯ Ú©Ø±ÛŒÙ…ÛŒ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="userName">Ù†Ø§Ù… Ø´Ù…Ø§:</label>
                    <input type="text" id="userName" placeholder="Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ">
                </div>
                <div class="form-group">
                    <label for="userRole">Ù†Ù‚Ø´:</label>
                    <select id="userRole">
                        <option value="student">Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²</option>
                        <option value="teacher">Ø§Ø³ØªØ§Ø¯</option>
                    </select>
                </div>
                <button class="btn-primary" onclick="joinClass()">ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ú©Ù„Ø§Ø³</button>
                
                <div class="class-link">
                    <h4>Ù„ÛŒÙ†Ú© Ø¯Ø¹ÙˆØª Ø¨Ù‡ Ú©Ù„Ø§Ø³:</h4>
                    <div class="link-box">
                        <span id="inviteLink">https://myclass.com/join/math7</span>
                        <button class="btn-copy" onclick="copyLink()">Ú©Ù¾ÛŒ</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ Ú©Ù„Ø§Ø³ -->
    <div id="classPage" class="page hidden">
        <div class="container">
            <header class="header">
                <div class="class-info">
                    <h1 id="classTitle">Ú©Ù„Ø§Ø³ Ø¢Ù†Ù„Ø§ÛŒÙ†</h1>
                    <div class="class-details">
                        <span id="teacherName">Ø§Ø³ØªØ§Ø¯: </span>
                        <span id="classTime">Ø²Ù…Ø§Ù†: Û±Û°:Û°Û° - Û±Û±:Û³Û°</span>
                        <span id="studentCount">ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†: Û°</span>
                    </div>
                </div>
                <div class="header-controls">
                    <button class="btn-secondary" onclick="generateInviteLink()">ğŸ“‹ Ø§ÛŒØ¬Ø§Ø¯ Ù„ÛŒÙ†Ú© Ø¯Ø¹ÙˆØª</button>
                    <button class="btn-secondary" onclick="leaveClass()">Ø®Ø±ÙˆØ¬ Ø§Ø² Ú©Ù„Ø§Ø³</button>
                </div>
            </header>

            <div class="main-content">
                <!-- Ø¨Ø®Ø´ ÙˆÛŒØ¯ÛŒÙˆÙ‡Ø§ -->
                <div class="video-section">
                    <div class="video-grid" id="videoGrid">
                        <!-- ÙˆÛŒØ¯ÛŒÙˆÙ‡Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ù¾ÙˆÛŒØ§ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
                    </div>
                </div>

                <!-- Ø³Ø§ÛŒØ¯Ø¨Ø§Ø± -->
                <div class="sidebar">
                    <!-- Ú†Øª -->
                    <div class="chat-container">
                        <div class="chat-header">
                            <h3>Ú†Øª Ú©Ù„Ø§Ø³</h3>
                            <button class="btn-sm" onclick="clearChat()">Ù¾Ø§Ú© Ú©Ø±Ø¯Ù†</button>
                        </div>
                        <div class="chat-messages" id="chatMessages">
                            <div class="message system">
                                <span>Ø¨Ù‡ Ú©Ù„Ø§Ø³ Ø¢Ù†Ù„Ø§ÛŒÙ† Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯!</span>
                            </div>
                        </div>
                        <div class="chat-input">
                            <input type="text" id="messageInput" placeholder="Ù¾ÛŒØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯..." 
                                   onkeypress="handleMessageKeypress(event)">
                            <button class="btn-primary" onclick="sendMessage()">Ø§Ø±Ø³Ø§Ù„</button>
                        </div>
                    </div>

                    <!-- Ù„ÛŒØ³Øª Ø´Ø±Ú©Øªâ€ŒÚ©Ù†Ù†Ø¯Ú¯Ø§Ù† -->
                    <div class="participants-container">
                        <h3>Ø´Ø±Ú©Øªâ€ŒÚ©Ù†Ù†Ø¯Ú¯Ø§Ù† (<span id="participantsCount">0</span>)</h3>
                        <div class="participants-list" id="participantsList">
                            <!-- Ù„ÛŒØ³Øª Ø¨Ù‡ ØµÙˆØ±Øª Ù¾ÙˆÛŒØ§ Ù¾Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ÛŒ Ù¾Ø§ÛŒÛŒÙ† -->
            <div class="controls">
                <button id="micBtn" class="btn-control" onclick="toggleMicrophone()">
                    ğŸ¤ Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ†
                </button>
                <button id="cameraBtn" class="btn-control" onclick="toggleCamera()">
                    ğŸ“¹ Ø¯ÙˆØ±Ø¨ÛŒÙ†
                </button>
                <button id="screenShareBtn" class="btn-control" onclick="toggleScreenShare()">
                    ğŸ“º Ø§Ø´ØªØ±Ø§Ú© ØµÙØ­Ù‡
                </button>
                <button id="handRaiseBtn" class="btn-control" onclick="raiseHand()">
                    âœ‹ Ø¯Ø³Øª Ø¨Ù„Ù†Ø¯ Ú©Ù†
                </button>
                <button class="btn-control" onclick="openWhiteboard()">
                    ğŸ“ ØªØ®ØªÙ‡ Ø³ÙÛŒØ¯
                </button>
                <button class="btn-control" onclick="openPolls()">
                    ğŸ“Š Ù†Ø¸Ø±Ø³Ù†Ø¬ÛŒ
                </button>
            </div>
        </div>
    </div>

    <!-- Ù…ÙˆØ¯Ø§Ù„ Ù„ÛŒÙ†Ú© Ø¯Ø¹ÙˆØª -->
    <div id="inviteModal" class="modal hidden">
        <div class="modal-content">
            <h3>Ù„ÛŒÙ†Ú© Ø¯Ø¹ÙˆØª Ø¨Ù‡ Ú©Ù„Ø§Ø³</h3>
            <div class="link-container">
                <input type="text" id="generatedLink" readonly>
                <button class="btn-copy" onclick="copyGeneratedLink()">Ú©Ù¾ÛŒ Ù„ÛŒÙ†Ú©</button>
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" onclick="closeInviteModal()">Ø¨Ø³ØªÙ†</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: #333;
    height: 100vh;
}

.page {
    width: 100%;
    height: 100vh;
}

.hidden {
    display: none !important;
}

/* ØµÙØ­Ù‡ ÙˆØ±ÙˆØ¯ */
.login-container {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.login-form {
    background: white;
    padding: 2rem;
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    width: 400px;
    max-width: 90%;
}

.login-form h2 {
    text-align: center;
    margin-bottom: 1.5rem;
    color: #2c3e50;
}

.form-group {
    margin-bottom: 1rem;
}

.form-group label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: bold;
}

.form-group input,
.form-group select {
    width: 100%;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 8px;
    font-size: 1rem;
}

.btn-primary {
    background: #3498db;
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 25px;
    cursor: pointer;
    font-size: 1rem;
    width: 100%;
    margin-top: 1rem;
    transition: all 0.3s ease;
}

.btn-primary:hover {
    background: #2980b9;
    transform: translateY(-2px);
}

.class-link {
    margin-top: 1.5rem;
    padding-top: 1.5rem;
    border-top: 1px solid #eee;
}

.link-box {
    display: flex;
    gap: 0.5rem;
    margin-top: 0.5rem;
}

.link-box span {
    flex: 1;
    background: #f8f9fa;
    padding: 8px 12px;
    border-radius: 6px;
    font-size: 0.9rem;
    border: 1px solid #ddd;
}

.btn-copy {
    background: #27ae60;
    color: white;
    border: none;
    padding: 8px 12px;
    border-radius: 6px;
    cursor: pointer;
}

/* ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ */
.container {
    display: flex;
    flex-direction: column;
    height: 100vh;
    background: white;
}

.header {
    background: #2c3e50;
    color: white;
    padding: 1rem 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.class-info h1 {
    margin-bottom: 0.5rem;
}

.class-details {
    display: flex;
    gap: 1rem;
    font-size: 0.9rem;
    opacity: 0.9;
}

.btn-secondary {
    background: #34495e;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 6px;
    cursor: pointer;
    margin-left: 0.5rem;
}

.main-content {
    flex: 1;
    display: flex;
    padding: 1rem;
    gap: 1rem;
    overflow: hidden;
}

.video-section {
    flex: 3;
    background: #000;
    border-radius: 10px;
    overflow: hidden;
}

.video-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1rem;
    padding: 1rem;
    height: 100%;
}

.video-item {
    background: #1a1a1a;
    border-radius: 10px;
    position: relative;
    aspect-ratio: 16/9;
}

video {
    width: 100%;
    height: 100%;
    border-radius: 10px;
    object-fit: cover;
}

.user-name {
    position: absolute;
    bottom: 10px;
    right: 10px;
    background: rgba(0, 0, 0, 0.7);
    color: white;
    padding: 5px 10px;
    border-radius: 15px;
    font-size: 0.9rem;
}

.sidebar {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 1rem;
    min-width: 300px;
}

.chat-container {
    background: white;
    border: 1px solid #ddd;
    border-radius: 10px;
    display: flex;
    flex-direction: column;
    height: 400px;
}

.chat-header {
    padding: 1rem;
    border-bottom: 1px solid #eee;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.chat-messages {
    flex: 1;
    padding: 1rem;
    overflow-y: auto;
}

.message {
    margin-bottom: 0.5rem;
    padding: 0.5rem 1rem;
    border-radius: 15px;
    max-width: 80%;
}

.message.system {
    background: #e3f2fd;
    margin: 0 auto;
    text-align: center;
    font-size: 0.9rem;
}

.message.own {
    background: #dcf8c6;
    margin-right: auto;
    margin-left: 0;
}

.message.other {
    background: #f1f1f1;
    margin-left: auto;
    margin-right: 0;
}

.chat-input {
    display: flex;
    padding: 1rem;
    gap: 0.5rem;
    border-top: 1px solid #eee;
}

.chat-input input {
    flex: 1;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 20px;
    outline: none;
}

.participants-container {
    background: white;
    border: 1px solid #ddd;
    border-radius: 10px;
    padding: 1rem;
}

.participants-list {
    max-height: 200px;
    overflow-y: auto;
    margin-top: 1rem;
}

.participant-item {
    padding: 0.5rem;
    border-bottom: 1px solid #eee;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.participant-item.teacher {
    background: #e8f5e8;
}

.controls {
    display: flex;
    justify-content: center;
    gap: 1rem;
    padding: 1rem;
    background: #f8f9fa;
    border-top: 1px solid #ddd;
}

.btn-control {
    background: #3498db;
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: 25px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    transition: all 0.3s ease;
}

.btn-control:hover {
    background: #2980b9;
    transform: translateY(-2px);
}

.btn-control.active {
    background: #e74c3c;
}

/* Ù…ÙˆØ¯Ø§Ù„ */
.modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
}

.modal-content {
    background: white;
    padding: 2rem;
    border-radius: 15px;
    width: 500px;
    max-width: 90%;
}

.link-container {
    display: flex;
    gap: 0.5rem;
    margin: 1rem 0;
}

.link-container input {
    flex: 1;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 6px;
}

.modal-actions {
    display: flex;
    justify-content: flex-end;
    gap: 0.5rem;
}

.btn-sm {
    padding: 6px 12px;
    font-size: 0.8rem;
}
// ÙˆØ¶Ø¹ÛŒØª Ú©Ù„Ø§Ø³
class ClassManager {
    constructor() {
        this.currentClass = null;
        this.currentUser = null;
        this.participants = [];
        this.localStream = null;
        this.isMicOn = true;
        this.isCameraOn = true;
        this.isHandRaised = false;
    }

    // Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§
    classes = {
        'math7': {
            title: 'Ø±ÛŒØ§Ø¶ÛŒ Ù¾Ø§ÛŒÙ‡ Ù‡ÙØªÙ…',
            teacher: 'Ø§Ø³ØªØ§Ø¯ Ø§Ø­Ù…Ø¯ÛŒ',
            time: 'Û±Û°:Û°Û° - Û±Û±:Û³Û°',
            inviteLink: 'https://myclass.com/join/math7'
        },
        'science7': {
            title: 'Ø¹Ù„ÙˆÙ… Ù¾Ø§ÛŒÙ‡ Ù‡ÙØªÙ…',
            teacher: 'Ø§Ø³ØªØ§Ø¯ Ù…Ø­Ù…Ø¯ÛŒ',
            time: 'Û±Û³:Û°Û° - Û±Û´:Û³Û°',
            inviteLink: 'https://myclass.com/join/science7'
        },
        'persian7': {
            title: 'Ø§Ø¯Ø¨ÛŒØ§Øª ÙØ§Ø±Ø³ÛŒ',
            teacher: 'Ø§Ø³ØªØ§Ø¯ Ú©Ø±ÛŒÙ…ÛŒ',
            time: 'Û°Û¸:Û°Û° - Û°Û¹:Û³Û°',
            inviteLink: 'https://myclass.com/join/persian7'
        }
    };

    // ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ú©Ù„Ø§Ø³
    joinClass(className, userName, userRole) {
        this.currentClass = this.classes[className];
        this.currentUser = {
            name: userName,
            role: userRole,
            id: this.generateId()
        };

        // Ø¨Ù‡ Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø±Ø§Ø¨Ø· Ú©Ø§Ø±Ø¨Ø±ÛŒ
        this.updateClassUI();
        this.addParticipant(this.currentUser);
        
        // Ù†Ù…Ø§ÛŒØ´ ØµÙØ­Ù‡ Ú©Ù„Ø§Ø³
        document.getElementById('loginPage').classList.add('hidden');
        document.getElementById('classPage').classList.remove('hidden');

        // Ø´Ø±ÙˆØ¹ ÙˆÛŒØ¯ÛŒÙˆ
        this.startVideo();
        
        // Ù¾ÛŒØ§Ù… Ø®ÙˆØ´â€ŒØ¢Ù…Ø¯Ú¯ÙˆÛŒÛŒ
        this.addSystemMessage(`${userName} Ø¨Ù‡ Ú©Ù„Ø§Ø³ Ù¾ÛŒÙˆØ³Øª`);
    }

    // Ø¨Ù‡ Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ù„Ø§Ø³ Ø¯Ø± UI
    updateClassUI() {
        document.getElementById('classTitle').textContent = this.currentClass.title;
        document.getElementById('teacherName').textContent = `Ø§Ø³ØªØ§Ø¯: ${this.currentClass.teacher}`;
        document.getElementById('classTime').textContent = `Ø²Ù…Ø§Ù†: ${this.currentClass.time}`;
        document.getElementById('inviteLink').textContent = this.currentClass.inviteLink;
    }

    // Ø´Ø±ÙˆØ¹ ÙˆÛŒØ¯ÛŒÙˆ
    async startVideo() {
        try {
            this.localStream = await navigator.mediaDevices.getUserMedia({
                video: true,
                audio: true
            });
            
            this.addVideoElement(this.currentUser, this.localStream);
            
        } catch (error) {
            console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø¯ÙˆØ±Ø¨ÛŒÙ†:', error);
            this.addSystemMessage('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø¯ÙˆØ±Ø¨ÛŒÙ† Ùˆ Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ†');
        }
    }

    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¹Ù†ØµØ± ÙˆÛŒØ¯ÛŒÙˆ
    addVideoElement(user, stream) {
        const videoGrid = document.getElementById('videoGrid');
        
        const videoItem = document.createElement('div');
        videoItem.className = 'video-item';
        videoItem.id = `video-${user.id}`;

        const video = document.createElement('video');
        video.srcObject = stream;
        video.autoplay = true;
        video.muted = user.id === this.currentUser.id;

        const userName = document.createElement('div');
        userName.className = 'user-name';
        userName.textContent = `${user.name} ${user.role === 'teacher' ? 'ğŸ‘¨â€ğŸ«' : 'ğŸ‘¦'}`;

        videoItem.appendChild(video);
        videoItem.appendChild(userName);
        videoGrid.appendChild(videoItem);
    }

    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø´Ø±Ú©Øªâ€ŒÚ©Ù†Ù†Ø¯Ù‡
    addParticipant(user) {
        this.participants.push(user);
        this.updateParticipantsList();
    }

    // Ø¨Ù‡ Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù„ÛŒØ³Øª Ø´Ø±Ú©Øªâ€ŒÚ©Ù†Ù†Ø¯Ú¯Ø§Ù†
    updateParticipantsList() {
        const list = document.getElementById('participantsList');
        const count = document.getElementById('participantsCount');
        const studentCount = document.getElementById('studentCount');
        
        list.innerHTML = '';
        
        this.participants.forEach(participant => {
            const item = document.createElement('div');
            item.className = `participant-item ${participant.role === 'teacher' ? 'teacher' : ''}`;
            item.innerHTML = `
                <span>${participant.role === 'teacher' ? 'ğŸ‘¨â€ğŸ«' : 'ğŸ‘¦'}</span>
                <span>${participant.name}</span>
                ${participant.role === 'teacher' ? '<span class="role-badge">Ø§Ø³ØªØ§Ø¯</span>' : ''}
            `;
            list.appendChild(item);
        });
        
        const students = this.participants.filter(p => p.role === 'student').length;
        count.textContent = this.participants.length;
        studentCount.textContent = `ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†: ${students}`;
    }

    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù¾ÛŒØ§Ù… Ø³ÛŒØ³ØªÙ…
    addSystemMessage(message) {
        this.addMessage(message, 'system');
    }

    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù¾ÛŒØ§Ù…
    addMessage(text, type = 'other', sender = 'Ø³ÛŒØ³ØªÙ…') {
        const chatMessages = document.getElementById('chatMessages');
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${type}`;
        
        if (type === 'system') {
            messageDiv.innerHTML = `<span>${text}</span>`;
        } else {
            messageDiv.innerHTML = `<strong>${sender}:</strong> ${text}`;
        }
        
        chatMessages.appendChild(messageDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // ØªÙˆÙ„ÛŒØ¯ ID
    generateId() {
        return Math.random().toString(36).substr(2, 9);
    }
}

// Ø§ÛŒØ¬Ø§Ø¯ Ù†Ù…ÙˆÙ†Ù‡ Ø§Ø² Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ù„Ø§Ø³
const classManager = new ClassManager();

// ØªÙˆØ§Ø¨Ø¹ Ø¹Ù…ÙˆÙ…ÛŒ
function joinClass() {
    const className = document.getElementById('className').value;
    const userName = document.getElementById('userName').value;
    const userRole = document.getElementById('userRole').value;

    if (!className || !userName) {
        alert('Ù„Ø·ÙØ§Ù‹ ØªÙ…Ø§Ù… ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯');
        return;
    }

    classManager.joinClass(className, userName, userRole);
}

function sendMessage() {
    const input = document.getElementById('messageInput');
    const message = input.value.trim();

    if (message) {
        classManager.addMessage(message, 'own', classManager.currentUser.name);
        input.value = '';
        
        // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ù¾Ø§Ø³Ø® Ø³Ø§ÛŒØ±ÛŒÙ†
        setTimeout(() => {
            const responses = [
                'Ø¹Ø§Ù„ÛŒ Ø¨ÙˆØ¯!',
                'Ø³ÙˆØ§Ù„ Ø®ÙˆØ¨ÛŒ Ù¾Ø±Ø³ÛŒØ¯ÛŒØ¯',
                'Ù…Ù† Ù‡Ù… Ù‡Ù…ÛŒÙ† Ù†Ø¸Ø± Ø±Ø§ Ø¯Ø§Ø±Ù…',
                'Ù„Ø·ÙØ§Ù‹ Ø¨ÛŒØ´ØªØ± ØªÙˆØ¶ÛŒØ­ Ø¯Ù‡ÛŒØ¯'
            ];
            const randomResponse = responses[Math.floor(Math.random() * responses.length)];
            const randomUser = classManager.participants[
                Math.floor(Math.random() * classManager.participants.length)
            ];
            if (randomUser && randomUser.id !== classManager.currentUser.id) {
                classManager.addMessage(randomResponse, 'other', randomUser.name);
            }
        }, 1000);
    }
}

function handleMessageKeypress(event) {
    if (event.key === 'Enter') {
        sendMessage();
    }
}

function toggleMicrophone() {
    const btn = document.getElementById('micBtn');
    classManager.isMicOn = !classManager.isMicOn;
    
    if (classManager.localStream) {
        classManager.localStream.getAudioTracks().forEach(track => {
            track.enabled = classManager.isMicOn;
        });
    }
    
    btn.textContent = classManager.isMicOn ? 'ğŸ¤ Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ†' : 'ğŸ”‡ Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ†';
    btn.classList.toggle('active', !classManager.isMicOn);
    
    classManager.addSystemMessage(`Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† ${classManager.isMicOn ? 'Ø±ÙˆØ´Ù†' : 'Ø®Ø§Ù…ÙˆØ´'} Ø´Ø¯`);
}

function toggleCamera() {
    const btn = document.getElementById('cameraBtn');
    classManager.isCameraOn = !classManager.isCameraOn;
    
    if (classManager.localStream) {
        classManager.localStream.getVideoTracks().forEach(track => {
            track.enabled = classManager.isCameraOn;
        });
    }
    
    btn.textContent = classManager.isCameraOn ? 'ğŸ“¹ Ø¯ÙˆØ±Ø¨ÛŒÙ†' : 'ğŸ“· Ø¯ÙˆØ±Ø¨ÛŒÙ†';
    btn.classList.toggle('active', !classManager.isCameraOn);
    
    classManager.addSystemMessage(`Ø¯ÙˆØ±Ø¨ÛŒÙ† ${classManager.isCameraOn ? 'Ø±ÙˆØ´Ù†' : 'Ø®Ø§Ù…ÙˆØ´'} Ø´Ø¯`);
}

function raiseHand() {
    const btn = document.getElementById('handRaiseBtn');
    classManager.isHandRaised = !classManager.isHandRaised;
    
    btn.classList.toggle('active', classManager.isHandRaised);
    btn.textContent = classManager.isHandRaised ? 'âœ‹ Ø¯Ø³Øª Ù¾Ø§ÛŒÛŒÙ†' : 'âœ‹ Ø¯Ø³Øª Ø¨Ù„Ù†Ø¯ Ú©Ù†';
    
    classManager.addSystemMessage(
        classManager.isHandRaised ? 
        `${classManager.currentUser.name} Ø¯Ø³Øª Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù„Ù†Ø¯ Ú©Ø±Ø¯` :
        `${classManager.currentUser.name} Ø¯Ø³Øª Ø®ÙˆØ¯ Ø±Ø§ Ù¾Ø§ÛŒÛŒÙ† Ø¢ÙˆØ±Ø¯`
    );
}

function generateInviteLink() {
    document.getElementById('generatedLink').value = classManager.currentClass.inviteLink;
    document.getElementById('inviteModal').classList.remove('hidden');
}

function closeInviteModal() {
    document.getElementById('inviteModal').classList.add('hidden');
}

function copyGeneratedLink() {
    const linkInput = document.getElementById('generatedLink');
    linkInput.select();
    document.execCommand('copy');
    alert('Ù„ÛŒÙ†Ú© Ú©Ù¾ÛŒ Ø´Ø¯!');
}

function copyLink() {
    const link = document.getElementById('inviteLink');
    const tempInput = document.createElement('input');
    tempInput.value = link.textContent;
    document.body.appendChild(tempInput);
    tempInput.select();
    document.execCommand('copy');
    document.body.removeChild(tempInput);
    alert('Ù„ÛŒÙ†Ú© Ú©Ù¾ÛŒ Ø´Ø¯!');
}

function clearChat() {
    document.getElementById('chatMessages').innerHTML = 
        '<div class="message system"><span>Ú†Øª Ù¾Ø§Ú© Ø´Ø¯</span></div>';
}

function leaveClass() {
    if (confirm('Ø¢ÛŒØ§ Ø§Ø² Ú©Ù„Ø§Ø³ Ø®Ø§Ø±Ø¬ Ù…ÛŒâ€ŒØ´ÙˆÛŒØ¯ØŸ')) {
        if (classManager.localStream) {
            classManager.localStream.getTracks().forEach(track => track.stop());
        }
        
        document.getElementById('classPage').classList.add('hidden');
        document.getElementById('loginPage').classList.remove('hidden');
        
        // Ø±ÛŒØ³Øª ÙØ±Ù…
        document.getElementById('className').value = '';
        document.getElementById('userName').value = '';
        document.getElementById('userRole').value = 'student';
    }
}

// ØªÙˆØ§Ø¨Ø¹ÛŒ Ú©Ù‡ Ø¨Ø¹Ø¯Ø§Ù‹ Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯
function toggleScreenShare() {
    classManager.addSystemMessage('Ø§Ù…Ú©Ø§Ù† Ø§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ ØµÙØ­Ù‡ Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯');
}

function openWhiteboard() {
    classManager.addSystemMessage('ØªØ®ØªÙ‡ Ø³ÙÛŒØ¯ Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯');
}

function openPolls() {
    classManager.addSystemMessage('Ù†Ø¸Ø±Ø³Ù†Ø¬ÛŒ Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯');
}

// Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ ÙˆØ±ÙˆØ¯ Ø³Ø§ÛŒØ± Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
setTimeout(() => {
    if (classManager.currentClass) {
        const fakeUsers = [
            { name: 'Ø¹Ù„ÛŒ Ù…Ø­Ù…Ø¯ÛŒ', role: 'student' },
            { name: 'Ø²Ù‡Ø±Ø§ Ú©Ø±ÛŒÙ…ÛŒ', role: 'student' },
            { name: 'Ù…Ù‡Ø¯ÛŒ Ø±Ø¶Ø§ÛŒÛŒ', role: 'student' }
        ];
        
        fakeUsers.forEach(user => {
            classManager.addParticipant({
                ...user,
                id: classManager.generateId()
            });
        });
        
        classManager.addSystemMessage('Ú†Ù†Ø¯ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¨Ù‡ Ú©Ù„Ø§Ø³ Ù¾ÛŒÙˆØ³ØªÙ†Ø¯');
    }
}, 3000);
